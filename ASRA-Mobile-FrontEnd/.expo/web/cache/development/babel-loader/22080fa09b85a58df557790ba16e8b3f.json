{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { createContext, useEffect, useState, useContext } from \"react\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\nimport { login } from \"../../api/auth\";\nimport { SocketContext } from \"../../app/socket\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport var AuthContext = createContext();\n\nfunction AuthProvider(_ref) {\n  var children = _ref.children;\n  var socket = useContext(SocketContext);\n\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      userInfo = _useState2[0],\n      setUserInfo = _useState2[1];\n\n  var _useState3 = useState(null),\n      _useState4 = _slicedToArray(_useState3, 2),\n      token = _useState4[0],\n      setToken = _useState4[1];\n\n  var _useState5 = useState(true),\n      _useState6 = _slicedToArray(_useState5, 2),\n      isLoading = _useState6[0],\n      setIsLoading = _useState6[1];\n\n  var signIn = function signIn(data) {\n    setIsLoading(true);\n    login(data).then(function (res) {\n      var userInfo = res;\n      setUserInfo(userInfo);\n      setToken(userInfo == null ? void 0 : userInfo.token);\n      AsyncStorage.setItem(\"ASRA\", userInfo == null ? void 0 : userInfo.token);\n      AsyncStorage.setItem(\"userInfo\", JSON.stringify(userInfo));\n      socket.emit(\"addNewUser\", userInfo == null ? void 0 : userInfo.username);\n    }).catch(function () {});\n    setIsLoading(false);\n  };\n\n  var logout = function logout() {\n    setIsLoading(true);\n    setToken(null);\n    AsyncStorage.removeItem(\"ASRA\");\n    AsyncStorage.removeItem(\"userInfo\");\n    socket == null ? void 0 : socket.emit(\"removeUser\");\n    setIsLoading(false);\n  };\n\n  var isLoggedIn = function _callee() {\n    var _userInfo, _token;\n\n    return _regeneratorRuntime.async(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            setIsLoading(true);\n            _context.next = 4;\n            return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"userInfo\"));\n\n          case 4:\n            _userInfo = _context.sent;\n            _context.next = 7;\n            return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"ASRA\"));\n\n          case 7:\n            _token = _context.sent;\n            _userInfo = JSON.parse(_userInfo);\n\n            if (_userInfo) {\n              setUserInfo(_userInfo);\n              setToken(_token);\n            }\n\n            setIsLoading(false);\n            _context.next = 15;\n            break;\n\n          case 13:\n            _context.prev = 13;\n            _context.t0 = _context[\"catch\"](0);\n\n          case 15:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[0, 13]], Promise);\n  };\n\n  useEffect(function () {\n    isLoggedIn();\n  }, []);\n  return _jsx(AuthContext.Provider, {\n    value: {\n      signIn: signIn,\n      logout: logout,\n      userInfo: userInfo,\n      token: token,\n      isLoading: isLoading\n    },\n    children: children\n  });\n}\n\nexport default AuthProvider;","map":{"version":3,"names":["React","createContext","useEffect","useState","useContext","AsyncStorage","login","SocketContext","AuthContext","AuthProvider","children","socket","userInfo","setUserInfo","token","setToken","isLoading","setIsLoading","signIn","data","then","res","setItem","JSON","stringify","emit","username","catch","logout","removeItem","isLoggedIn","getItem","parse"],"sources":["/Users/macbook/Documents/00.ASRA/ASRA-Mobile-FrontEnd/src/components/permission/AuthProvider.jsx"],"sourcesContent":["import React, { createContext, useEffect, useState, useContext } from \"react\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\nimport { login } from \"../../api/auth\";\nimport { SocketContext } from \"../../app/socket\";\nexport const AuthContext = createContext();\n\nfunction AuthProvider({ children }) {\n  const socket = useContext(SocketContext);\n  const [userInfo, setUserInfo] = useState(null);\n  const [token, setToken] = useState(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  const signIn = (data) => {\n    setIsLoading(true);\n    login(data)\n      .then((res) => {\n        let userInfo = res;\n        setUserInfo(userInfo);\n        setToken(userInfo?.token);\n        AsyncStorage.setItem(\"ASRA\", userInfo?.token);\n        AsyncStorage.setItem(\"userInfo\", JSON.stringify(userInfo));\n        socket.emit(\"addNewUser\", userInfo?.username);\n      })\n      .catch(() => {});\n    setIsLoading(false);\n  };\n\n  const logout = () => {\n    setIsLoading(true);\n    setToken(null);\n    AsyncStorage.removeItem(\"ASRA\");\n    AsyncStorage.removeItem(\"userInfo\");\n    socket?.emit(\"removeUser\")\n    setIsLoading(false);\n  };\n\n  const isLoggedIn = async () => {\n    try {\n      setIsLoading(true);\n      let userInfo = await AsyncStorage.getItem(\"userInfo\");\n      let token = await AsyncStorage.getItem(\"ASRA\");\n      userInfo = JSON.parse(userInfo);\n\n      if (userInfo) {\n        setUserInfo(userInfo);\n        setToken(token);\n      }\n    \n\n      setIsLoading(false);\n    } catch (error) {}\n  };\n\n  useEffect(() => {\n    isLoggedIn();\n  }, []);\n\n  return (\n    <AuthContext.Provider\n      value={{ signIn, logout, userInfo, token, isLoading }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport default AuthProvider;\n"],"mappings":";;AAAA,OAAOA,KAAP,IAAgBC,aAAhB,EAA+BC,SAA/B,EAA0CC,QAA1C,EAAoDC,UAApD,QAAsE,OAAtE;AACA,OAAOC,YAAP,MAAyB,2CAAzB;AACA,SAASC,KAAT;AACA,SAASC,aAAT;;AACA,OAAO,IAAMC,WAAW,GAAGP,aAAa,EAAjC;;AAEP,SAASQ,YAAT,OAAoC;EAAA,IAAZC,QAAY,QAAZA,QAAY;EAClC,IAAMC,MAAM,GAAGP,UAAU,CAACG,aAAD,CAAzB;;EACA,gBAAgCJ,QAAQ,CAAC,IAAD,CAAxC;EAAA;EAAA,IAAOS,QAAP;EAAA,IAAiBC,WAAjB;;EACA,iBAA0BV,QAAQ,CAAC,IAAD,CAAlC;EAAA;EAAA,IAAOW,KAAP;EAAA,IAAcC,QAAd;;EACA,iBAAkCZ,QAAQ,CAAC,IAAD,CAA1C;EAAA;EAAA,IAAOa,SAAP;EAAA,IAAkBC,YAAlB;;EAEA,IAAMC,MAAM,GAAG,SAATA,MAAS,CAACC,IAAD,EAAU;IACvBF,YAAY,CAAC,IAAD,CAAZ;IACAX,KAAK,CAACa,IAAD,CAAL,CACGC,IADH,CACQ,UAACC,GAAD,EAAS;MACb,IAAIT,QAAQ,GAAGS,GAAf;MACAR,WAAW,CAACD,QAAD,CAAX;MACAG,QAAQ,CAACH,QAAD,oBAACA,QAAQ,CAAEE,KAAX,CAAR;MACAT,YAAY,CAACiB,OAAb,CAAqB,MAArB,EAA6BV,QAA7B,oBAA6BA,QAAQ,CAAEE,KAAvC;MACAT,YAAY,CAACiB,OAAb,CAAqB,UAArB,EAAiCC,IAAI,CAACC,SAAL,CAAeZ,QAAf,CAAjC;MACAD,MAAM,CAACc,IAAP,CAAY,YAAZ,EAA0Bb,QAA1B,oBAA0BA,QAAQ,CAAEc,QAApC;IACD,CARH,EASGC,KATH,CASS,YAAM,CAAE,CATjB;IAUAV,YAAY,CAAC,KAAD,CAAZ;EACD,CAbD;;EAeA,IAAMW,MAAM,GAAG,SAATA,MAAS,GAAM;IACnBX,YAAY,CAAC,IAAD,CAAZ;IACAF,QAAQ,CAAC,IAAD,CAAR;IACAV,YAAY,CAACwB,UAAb,CAAwB,MAAxB;IACAxB,YAAY,CAACwB,UAAb,CAAwB,UAAxB;IACAlB,MAAM,QAAN,YAAAA,MAAM,CAAEc,IAAR,CAAa,YAAb;IACAR,YAAY,CAAC,KAAD,CAAZ;EACD,CAPD;;EASA,IAAMa,UAAU,GAAG;IAAA;;IAAA;MAAA;QAAA;UAAA;YAAA;YAEfb,YAAY,CAAC,IAAD,CAAZ;YAFe;YAAA,iCAGMZ,YAAY,CAAC0B,OAAb,CAAqB,UAArB,CAHN;;UAAA;YAGXnB,SAHW;YAAA;YAAA,iCAIGP,YAAY,CAAC0B,OAAb,CAAqB,MAArB,CAJH;;UAAA;YAIXjB,MAJW;YAKfF,SAAQ,GAAGW,IAAI,CAACS,KAAL,CAAWpB,SAAX,CAAX;;YAEA,IAAIA,SAAJ,EAAc;cACZC,WAAW,CAACD,SAAD,CAAX;cACAG,QAAQ,CAACD,MAAD,CAAR;YACD;;YAGDG,YAAY,CAAC,KAAD,CAAZ;YAbe;YAAA;;UAAA;YAAA;YAAA;;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,CAAnB;;EAiBAf,SAAS,CAAC,YAAM;IACd4B,UAAU;EACX,CAFQ,EAEN,EAFM,CAAT;EAIA,OACE,KAAC,WAAD,CAAa,QAAb;IACE,KAAK,EAAE;MAAEZ,MAAM,EAANA,MAAF;MAAUU,MAAM,EAANA,MAAV;MAAkBhB,QAAQ,EAARA,QAAlB;MAA4BE,KAAK,EAALA,KAA5B;MAAmCE,SAAS,EAATA;IAAnC,CADT;IAAA,UAGGN;EAHH,EADF;AAOD;;AAED,eAAeD,YAAf"},"metadata":{},"sourceType":"module"}